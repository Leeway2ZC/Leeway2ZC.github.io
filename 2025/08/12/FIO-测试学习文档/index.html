<!DOCTYPE html><html lang="cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> FIO 测试学习文档 · LeeWay</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="FIO 测试学习文档 - David Lee"><meta name="keywords"><meta name="author" content="David Lee"><link rel="short icon" href="https://leeway2zcblog-1373523181.cos.ap-guangzhou.myqcloud.com/img/favicon-32x32.png"><link rel="stylesheet" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://leeway2zc.top/atom.xml" title="LeeWay"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="LeeWay" type="application/atom+xml">
</head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="https://leeway2zcblog-1373523181.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250811154253_3.jpg"></a><ul id="nav_list" class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/categories/live/" target="_self" data-hover="生活" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/categories/read/" target="_self" data-hover="读书" class="nav-list-link">读书</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div id="nav_btn" class="nav-btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">FIO 测试学习文档</h1><div class="post-info">2025-08-12<p id="busuanzi_container_page_pv" class="visit"><span id="busuanzi_value_page_pv"> </span><span>次访问</span></p></div><div class="post-content"><h1><center>FIO测试 学习文档</center></h1>

<h2 id="Job-File-配置文件执行-FIO-测试"><a href="#Job-File-配置文件执行-FIO-测试" class="headerlink" title="Job File 配置文件执行 FIO 测试"></a>Job File 配置文件执行 FIO 测试</h2><blockquote>
<p>通过编写一个ini格式的Job File来执行FIO测试，使用fio jobfile.fio完成测试</p>
</blockquote>
<h3 id="global-常用参数以及说明"><a href="#global-常用参数以及说明" class="headerlink" title="[global] 常用参数以及说明"></a>[global] 常用参数以及说明</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>取值</th>
<th>作用说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>iodepth_batch_complete</code></td>
<td><code>8</code></td>
<td>io请求过来后，能retrieve获得的最多请求数，即当io请求提交后，取出处理的io请求数</td>
</tr>
<tr>
<td><code>iodepth_batch</code></td>
<td>16</td>
<td>io队列请求丢过来后，积攒到16个io请求后立即提交，一般是iodepth的值</td>
</tr>
<tr>
<td><code>ioengine</code></td>
<td><code>libaio</code></td>
<td>使用 Linux 的异步 I&#x2F;O 引擎（libaio），适合测试真实负载环境</td>
</tr>
<tr>
<td><code>rw</code></td>
<td><code>read</code></td>
<td>I&#x2F;O 模式为顺序读（sequential read），用于测试读取吞吐能力，除了read还可以取值write,rw,randread,randwrite,randrw</td>
</tr>
<tr>
<td><code>bs</code></td>
<td><code>1M</code></td>
<td>每次 I&#x2F;O 操作的块大小为 1MB，影响数据吞吐与 IOPS</td>
</tr>
<tr>
<td><code>size</code></td>
<td><code>10G</code></td>
<td>每个 job 的总 I&#x2F;O 数据量上限为 10GB（如果不是基于时间模式才生效）</td>
</tr>
<tr>
<td><code>time_based</code></td>
<td><code>1</code></td>
<td>启用基于时间的测试模式，不以数据总量决定测试结束</td>
</tr>
<tr>
<td><code>runtime</code></td>
<td><code>30</code></td>
<td>测试持续时间为 30 秒</td>
</tr>
<tr>
<td><code>norandommap</code></td>
<td><code>1</code></td>
<td>禁用随机 I&#x2F;O 映射表，减少运行时开销，每个块可能多次读写可能不使用</td>
</tr>
<tr>
<td><code>randrepeat</code></td>
<td><code>1</code></td>
<td>使用固定的随机种子，每次运行能复现相同的随机序列</td>
</tr>
<tr>
<td><code>group_reporting</code></td>
<td><code>1</code></td>
<td>合并组内 job 的测试结果，统一输出</td>
</tr>
<tr>
<td><code>iodepth</code></td>
<td><code>8</code></td>
<td>设置每个 job 的 I&#x2F;O 队列深度为 8，控制并发请求数量，线程一次提出8个I&#x2F;O请求</td>
</tr>
<tr>
<td><code>direct</code></td>
<td><code>1</code></td>
<td>启用 Direct I&#x2F;O，跳过文件系统缓存，直接访问存储设备</td>
</tr>
<tr>
<td><code>numjobs</code></td>
<td><code>10</code></td>
<td>启动 10 个并发 job，提高测试负载并模拟多线程环境</td>
</tr>
<tr>
<td>thread</td>
<td>1</td>
<td>使用线程创建job，适合numjobs值很大的情况，模拟多应用高并发场景，但要求测试复杂度较低，需要处理同步问题，容易崩溃</td>
</tr>
<tr>
<td>ramp_time</td>
<td>30</td>
<td>跑每个job之前进行的预热时间</td>
</tr>
</tbody></table>
<h3 id="file-常用参数以及说明"><a href="#file-常用参数以及说明" class="headerlink" title="[file] 常用参数以及说明"></a>[file] 常用参数以及说明</h3><p><img src="https://leeway2zcblog-1373523181.cos.ap-guangzhou.myqcloud.com/img/image-20250806111305509.png" alt="image-20250806111305509"></p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>取值</th>
<th>作用说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>filename</code></td>
<td><code>/mnt/glfs/file0</code></td>
<td>指定测试文件的路径，这里是挂载在 <code>/mnt/glfs/</code> 下的一个文件，通常为分布式文件系统路径</td>
</tr>
</tbody></table>
<h2 id="命令行格式参数与说明"><a href="#命令行格式参数与说明" class="headerlink" title="命令行格式参数与说明"></a>命令行格式参数与说明</h2><blockquote>
<p>通过命令行参数执行 FIO 测试，便于与shell脚本结合使用</p>
</blockquote>
<p><img src="https://leeway2zcblog-1373523181.cos.ap-guangzhou.myqcloud.com/img/image-20250806111755997.png" alt="image-20250806111755997"></p>
<p>命令行参数含义如下：</p>
<p><code>--filename=...</code>：测试设备，这里是多个 NVMe 磁盘。</p>
<p><code>--direct=1</code>：绕过文件系统缓存，直接 I&#x2F;O。</p>
<p><code>--norandommap</code>：防止随机访问映射（提高随机性）。</p>
<p><code>--rw=$&#123;k&#125;</code>：I&#x2F;O 模式，传入变量 <code>k</code>，如 <code>read</code>、<code>write</code>。</p>
<p><code>--ioengine=libaio</code>：使用异步 I&#x2F;O 引擎。</p>
<p><code>--size=10G</code>：每个 job 的 I&#x2F;O 数据大小。</p>
<p><code>--iodepth=8</code>：每个 job 的 I&#x2F;O 队列深度。</p>
<p><code>--bs=$&#123;i&#125;</code>：块大小，传入变量 <code>i</code>。</p>
<p><code>--group_reporting</code>：报告时合并所有 job 的结果。</p>
<p><code>--name=test</code>：任务名。</p>
<p><code>--numjobs=$&#123;j&#125;</code>：并发 job 数量。</p>
<p><code>--runtime=$&#123;test_time&#125;</code>：测试时间（单位为秒），变量 <code>test_time</code> 应该事先定义。</p>
<p><code>--output=$&#123;result_file&#125;</code>：将结果输出到指定日志文件。</p>
<h2 id="fio-结果解读"><a href="#fio-结果解读" class="headerlink" title="fio 结果解读"></a>fio 结果解读</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio -filename=/dev/vdb -direct=1 -iodepth 32 -thread -rw=randrw -rwmixread=70 -ioengine=libaio -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=testfio</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">testfio: (<span class="attr">g</span>=<span class="number">0</span>): rw=randrw, bs=(R) <span class="number">16.0</span>KiB-<span class="number">16.0</span>KiB, (W) <span class="number">16.0</span>KiB-<span class="number">16.0</span>KiB, (T) <span class="number">16.0</span>KiB-<span class="number">16.0</span>KiB, ioengine=libaio, iodepth=<span class="number">32</span></span><br><span class="line">...</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 10 threads</span><br><span class="line">Jobs: 8 (<span class="attr">f</span>=<span class="number">8</span>): [m(<span class="number">4</span>),_(<span class="number">1</span>),m(<span class="number">3</span>),_(<span class="number">1</span>),m(<span class="number">1</span>)][<span class="number">91.9</span>%][r=<span class="number">677</span>MiB/s,w=<span class="number">291</span>MiB/s][r=<span class="number">43.4</span>k,w=<span class="number">18.6</span>k IOPS][eta <span class="number">00</span>m:<span class="number">03</span>s]</span><br><span class="line">testfio: (<span class="attr">groupid</span>=<span class="number">0</span>, jobs=<span class="number">10</span>): err= <span class="number">0</span>: pid=<span class="number">3335</span>: Thu Sep <span class="number">24</span> <span class="number">04</span>:<span class="number">25</span>:<span class="number">36</span> <span class="number">2020</span></span><br><span class="line">   read: <span class="attr">IOPS</span>=<span class="number">26.6</span>k, BW=<span class="number">416</span>MiB/s (<span class="number">436</span>MB/s)(<span class="number">13.0</span>GiB/<span class="number">34469</span>msec)</span><br><span class="line">    slat (usec): <span class="attr">min</span>=<span class="number">2</span>, max=<span class="number">375533</span>, avg=<span class="number">40.79</span>, stdev=<span class="number">1058.36</span></span><br><span class="line">    clat (usec): <span class="attr">min</span>=<span class="number">65</span>, max=<span class="number">455661</span>, avg=<span class="number">8296.62</span>, stdev=<span class="number">12218.78</span></span><br><span class="line">     lat (usec): <span class="attr">min</span>=<span class="number">76</span>, max=<span class="number">455669</span>, avg=<span class="number">8338.53</span>, stdev=<span class="number">12297.28</span></span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  <span class="attr">1.00th</span>=[   <span class="number">955</span>],  <span class="number">5.00</span>th=[  <span class="number">1745</span>], <span class="number">10.00</span>th=[  <span class="number">2245</span>], <span class="number">20.00</span>th=[  <span class="number">2868</span>],</span><br><span class="line">     | <span class="attr">30.00th</span>=[  <span class="number">3556</span>], <span class="number">40.00</span>th=[  <span class="number">4228</span>], <span class="number">50.00</span>th=[  <span class="number">4948</span>], <span class="number">60.00</span>th=[  <span class="number">5735</span>],</span><br><span class="line">     | <span class="attr">70.00th</span>=[  <span class="number">7177</span>], <span class="number">80.00</span>th=[ <span class="number">10159</span>], <span class="number">90.00</span>th=[ <span class="number">17957</span>], <span class="number">95.00</span>th=[ <span class="number">26608</span>],</span><br><span class="line">     | <span class="attr">99.00th</span>=[ <span class="number">51643</span>], <span class="number">99.50</span>th=[ <span class="number">63177</span>], <span class="number">99.90</span>th=[<span class="number">147850</span>], <span class="number">99.95</span>th=[<span class="number">189793</span>],</span><br><span class="line">     | <span class="attr">99.99th</span>=[<span class="number">287310</span>]</span><br><span class="line">   bw (  KiB/s): <span class="attr">min</span>=  <span class="number">768</span>, max=<span class="number">128736</span>, per=<span class="number">9.86</span>%, avg=<span class="number">41984.49</span>, stdev=<span class="number">31169.50</span>, samples=<span class="number">678</span></span><br><span class="line">   iops        : <span class="attr">min</span>=   <span class="number">48</span>, max= <span class="number">8046</span>, avg=<span class="number">2623.95</span>, stdev=<span class="number">1948.09</span>, samples=<span class="number">678</span></span><br><span class="line">  write: <span class="attr">IOPS</span>=<span class="number">11.4</span>k, BW=<span class="number">178</span>MiB/s (<span class="number">187</span>MB/s)(<span class="number">6149</span>MiB/<span class="number">34469</span>msec)</span><br><span class="line">    slat (usec): <span class="attr">min</span>=<span class="number">2</span>, max=<span class="number">397853</span>, avg=<span class="number">44.61</span>, stdev=<span class="number">1202.15</span></span><br><span class="line">    clat (usec): <span class="attr">min</span>=<span class="number">135</span>, max=<span class="number">455595</span>, avg=<span class="number">8322.44</span>, stdev=<span class="number">12370.30</span></span><br><span class="line">     lat (usec): <span class="attr">min</span>=<span class="number">148</span>, max=<span class="number">455605</span>, avg=<span class="number">8368.17</span>, stdev=<span class="number">12458.54</span></span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  <span class="attr">1.00th</span>=[   <span class="number">947</span>],  <span class="number">5.00</span>th=[  <span class="number">1762</span>], <span class="number">10.00</span>th=[  <span class="number">2245</span>], <span class="number">20.00</span>th=[  <span class="number">2868</span>],</span><br><span class="line">     | <span class="attr">30.00th</span>=[  <span class="number">3556</span>], <span class="number">40.00</span>th=[  <span class="number">4228</span>], <span class="number">50.00</span>th=[  <span class="number">4948</span>], <span class="number">60.00</span>th=[  <span class="number">5735</span>],</span><br><span class="line">     | <span class="attr">70.00th</span>=[  <span class="number">7177</span>], <span class="number">80.00</span>th=[ <span class="number">10290</span>], <span class="number">90.00</span>th=[ <span class="number">17957</span>], <span class="number">95.00</span>th=[ <span class="number">26870</span>],</span><br><span class="line">     | <span class="attr">99.00th</span>=[ <span class="number">51643</span>], <span class="number">99.50</span>th=[ <span class="number">62653</span>], <span class="number">99.90</span>th=[<span class="number">162530</span>], <span class="number">99.95</span>th=[<span class="number">193987</span>],</span><br><span class="line">     | <span class="attr">99.99th</span>=[<span class="number">421528</span>]</span><br><span class="line">   bw (  KiB/s): <span class="attr">min</span>=  <span class="number">288</span>, max=<span class="number">53120</span>, per=<span class="number">9.86</span>%, avg=<span class="number">18002.25</span>, stdev=<span class="number">13353.37</span>, samples=<span class="number">678</span></span><br><span class="line">   iops        : <span class="attr">min</span>=   <span class="number">18</span>, max= <span class="number">3320</span>, avg=<span class="number">1125.06</span>, stdev=<span class="number">834.58</span>, samples=<span class="number">678</span></span><br><span class="line">  lat (usec)   : <span class="attr">100</span>=<span class="number">0.01</span>%, <span class="number">250</span>=<span class="number">0.01</span>%, <span class="number">500</span>=<span class="number">0.06</span>%, <span class="number">750</span>=<span class="number">0.45</span>%, <span class="number">1000</span>=<span class="number">0.62</span>%</span><br><span class="line">  lat (msec)   : <span class="attr">2</span>=<span class="number">6.00</span>%, <span class="number">4</span>=<span class="number">30.00</span>%, <span class="number">10</span>=<span class="number">42.44</span>%, <span class="number">20</span>=<span class="number">12.12</span>%, <span class="number">50</span>=<span class="number">7.23</span>%</span><br><span class="line">  lat (msec)   : <span class="attr">100</span>=<span class="number">0.88</span>%, <span class="number">250</span>=<span class="number">0.18</span>%, <span class="number">500</span>=<span class="number">0.02</span>%</span><br><span class="line">  cpu          : <span class="attr">usr</span>=<span class="number">1.74</span>%, sys=<span class="number">3.50</span>%, ctx=<span class="number">47684</span>, majf=<span class="number">0</span>, minf=<span class="number">10</span></span><br><span class="line">  IO depths    : <span class="attr">1</span>=<span class="number">0.1</span>%, <span class="number">2</span>=<span class="number">0.1</span>%, <span class="number">4</span>=<span class="number">0.1</span>%, <span class="number">8</span>=<span class="number">0.1</span>%, <span class="number">16</span>=<span class="number">0.1</span>%, <span class="number">32</span>=<span class="number">100.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     submit    : <span class="attr">0</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">100.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.0</span>%, <span class="number">64</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     complete  : <span class="attr">0</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">100.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.1</span>%, <span class="number">64</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     issued rwts: <span class="attr">total</span>=<span class="number">917210</span>,<span class="number">393510</span>,<span class="number">0</span>,<span class="number">0</span> short=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span> dropped=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">     latency   : <span class="attr">target</span>=<span class="number">0</span>, window=<span class="number">0</span>, percentile=<span class="number">100.00</span>%, depth=<span class="number">32</span></span><br><span class="line"></span><br><span class="line">Run status group 0 (all jobs):</span><br><span class="line">   READ: <span class="attr">bw</span>=<span class="number">416</span>MiB/s (<span class="number">436</span>MB/s), <span class="number">416</span>MiB/s-<span class="number">416</span>MiB/s (<span class="number">436</span>MB/s-<span class="number">436</span>MB/s), io=<span class="number">13.0</span>GiB (<span class="number">15.0</span>GB), run=<span class="number">34469</span>-<span class="number">34469</span>msec</span><br><span class="line">  WRITE: <span class="attr">bw</span>=<span class="number">178</span>MiB/s (<span class="number">187</span>MB/s), <span class="number">178</span>MiB/s-<span class="number">178</span>MiB/s (<span class="number">187</span>MB/s-<span class="number">187</span>MB/s), io=<span class="number">6149</span>MiB (<span class="number">6447</span>MB), run=<span class="number">34469</span>-<span class="number">34469</span>msec</span><br><span class="line"></span><br><span class="line">Disk stats (read/write):</span><br><span class="line">  vdb: <span class="attr">ios</span>=<span class="number">914415</span>/<span class="number">392173</span>, merge=<span class="number">0</span>/<span class="number">0</span>, ticks=<span class="number">5986235</span>/<span class="number">2577115</span>, in_queue=<span class="number">7910956</span>, util=<span class="number">65.39</span>%</span><br></pre></td></tr></table></figure>

<p>IOPS: 每秒的输入输出量(或读写次数)，是衡量磁盘性能的主要指标之一；</p>
<p>Bw: 带宽，带宽是指平均每秒读写的数据量。在同样的延时指标下，增加并发可以提高吞吐量。</p>
<blockquote>
<p>存储性能的好坏，需要IOPS、延迟、带宽三者结合来看</p>
</blockquote>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slat (usec): <span class="attr">min</span>=<span class="number">2</span>, max=<span class="number">397853</span>, avg=<span class="number">44.61</span>, stdev=<span class="number">1202.15</span></span><br><span class="line">clat (usec): <span class="attr">min</span>=<span class="number">135</span>, max=<span class="number">455595</span>, avg=<span class="number">8322.44</span>, stdev=<span class="number">12370.30</span></span><br><span class="line">lat (usec): <span class="attr">min</span>=<span class="number">148</span>, max=<span class="number">455605</span>, avg=<span class="number">8368.17</span>, stdev=<span class="number">12458.54</span></span><br></pre></td></tr></table></figure>

<p>I&#x2F;O延迟包括三种：slat，clat，lat：关系是 lat &#x3D; slat + clat；</p>
<ul>
<li>slat 表示fio submit某个I&#x2F;O的延迟；</li>
<li>clat 表示fio complete某个I&#x2F;O的延迟；</li>
<li>lat 表示从fio将请求提交给内核，再到内核完成这个I&#x2F;O为止所需要的时间；</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lat (usec)   : <span class="attr">100</span>=<span class="number">0.01</span>%, <span class="number">250</span>=<span class="number">0.01</span>%, <span class="number">500</span>=<span class="number">0.06</span>%, <span class="number">750</span>=<span class="number">0.45</span>%, <span class="number">1000</span>=<span class="number">0.62</span>%</span><br><span class="line">lat (msec)   : <span class="attr">2</span>=<span class="number">6.00</span>%, <span class="number">4</span>=<span class="number">30.00</span>%, <span class="number">10</span>=<span class="number">42.44</span>%, <span class="number">20</span>=<span class="number">12.12</span>%, <span class="number">50</span>=<span class="number">7.23</span>%</span><br><span class="line">lat (msec)   : <span class="attr">100</span>=<span class="number">0.88</span>%, <span class="number">250</span>=<span class="number">0.18</span>%, <span class="number">500</span>=<span class="number">0.02</span>%</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>这组数据表明lat(latency：延迟 )的分布；有0.01%的request延迟&lt;100us，有0.01%的 100us &lt; request lat &lt; 250us，有0.06%的 250us &lt; request lat &lt; 500us，以此类推；</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpu          : <span class="attr">usr</span>=<span class="number">1.74</span>%, sys=<span class="number">3.50</span>%, ctx=<span class="number">47684</span>, majf=<span class="number">0</span>, minf=<span class="number">10</span></span><br></pre></td></tr></table></figure>

<ul>
<li>usr：表示用户空间进程；</li>
<li>sys：表示内核空间进程；</li>
<li>因为上下文切换导致的主要和次要页面失败的用户&#x2F;系统 CPU使用百分比。因为测试被配置的使用直接IO，因此有很少的页面失败：</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IO depths    : <span class="attr">1</span>=<span class="number">0.1</span>%, <span class="number">2</span>=<span class="number">0.1</span>%, <span class="number">4</span>=<span class="number">0.1</span>%, <span class="number">8</span>=<span class="number">0.1</span>%, <span class="number">16</span>=<span class="number">0.1</span>%, <span class="number">32</span>=<span class="number">0.1</span>%, &gt;=<span class="number">64</span>=<span class="number">99.9</span>%</span><br></pre></td></tr></table></figure>

<ul>
<li>iodepth设置用来控制在任何时间有多少IO分发给系统。这完全是应用方面的，意味着它和设备的IO队列做不同的事情，iodepth设置为1因此IO深度在100%的时间里一直是一个1；</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Run status group 0 (all jobs):</span><br><span class="line">   READ: <span class="attr">bw</span>=<span class="number">416</span>MiB/s (<span class="number">436</span>MB/s), <span class="number">416</span>MiB/s-<span class="number">416</span>MiB/s (<span class="number">436</span>MB/s-<span class="number">436</span>MB/s), io=<span class="number">13.0</span>GiB (<span class="number">15.0</span>GB), run=<span class="number">34469</span>-<span class="number">34469</span>msec</span><br><span class="line">  WRITE: <span class="attr">bw</span>=<span class="number">178</span>MiB/s (<span class="number">187</span>MB/s), <span class="number">178</span>MiB/s-<span class="number">178</span>MiB/s (<span class="number">187</span>MB/s-<span class="number">187</span>MB/s), io=<span class="number">6149</span>MiB (<span class="number">6447</span>MB), run=<span class="number">34469</span>-<span class="number">34469</span>msec</span><br></pre></td></tr></table></figure>

<ul>
<li>bw&#x3D;这组进程的总带宽，每个线程的带宽（设置了numjobs&gt;1这里会很明显）；</li>
<li>io&#x3D;这组总io大小；</li>
<li>线程的最小和最大时间；</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Disk stats (read/write):</span><br><span class="line">  vdb: ios=914415/392173, merge=0/0, ticks=5986235/2577115, in_queue=7910956, util=65.39%</span><br></pre></td></tr></table></figure>

<ul>
<li>ios：读&#x2F;写 I&#x2F;O 次数</li>
<li>merge：合并的请求数</li>
<li>ticks：花在 I&#x2F;O 上的时间（ms）</li>
<li>in_queue：请求在队列里的时间（ms）</li>
<li>util：磁盘利用率（100% 说明磁盘一直在忙）</li>
</ul>
<h3 id="四个关键参数"><a href="#四个关键参数" class="headerlink" title="四个关键参数"></a>四个关键参数</h3><p><strong>bw（带宽）</strong></p>
<ul>
<li>顺序 I&#x2F;O 时：带宽是核心指标（HPC 大文件通常看 GB&#x2F;s）</li>
<li>随机 I&#x2F;O 时：带宽 + IOPS 结合看</li>
<li>判断合理性 → 和硬件理论上限比，例如 NVMe 单盘顺序写可达 3.5GB&#x2F;s，集群可叠加。</li>
</ul>
<p><strong>iops</strong></p>
<ul>
<li>小块随机 I&#x2F;O 的核心指标</li>
<li>HPC 元数据测试或数据库场景才特别看这个</li>
<li>和理论值比：NVMe 可到 700k IOPS（4KB 随机读），集群按并行度成倍增加。</li>
</ul>
<p><strong>延迟（slat &#x2F; clat &#x2F; lat）</strong></p>
<ul>
<li><code>slat</code> &#x3D; 提交延迟（fio 发出请求到内核调度的时间）</li>
<li><code>clat</code> &#x3D; 完成延迟（存储设备处理时间）</li>
<li><code>lat</code> &#x3D; 总延迟（两者之和）</li>
<li>重点看 <strong>平均值</strong> 和 <strong>高百分位数</strong>（如 99.99th）</li>
<li>判断合理性 → HPC 顺序 I&#x2F;O 延迟在 ms 级是正常，小块随机 NVMe 应在 100µs~1ms 内。</li>
</ul>
<p><strong>百分位延迟</strong></p>
<ul>
<li>HPC 场景需要看尾延迟（tail latency），因为并行任务很怕极端慢请求。</li>
<li>如果 99.99% 延迟明显高于平均值很多，说明系统在高并发下有抖动问题。</li>
</ul>
<h3 id="影响四个关键参数的主要-fio-参数"><a href="#影响四个关键参数的主要-fio-参数" class="headerlink" title="影响四个关键参数的主要 fio 参数"></a>影响四个关键参数的主要 fio 参数</h3><table>
<thead>
<tr>
<th>指标</th>
<th>关键影响参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>带宽 (bw)</strong></td>
<td><code>bs</code>（块大小）、<code>iodepth</code>、<code>numjobs</code>、<code>rw</code>（读写模式）</td>
<td>大块顺序 I&#x2F;O 通过较大 <code>bs</code> 和 <code>iodepth</code> 来提升吞吐；<code>numjobs</code> 多进程并发可叠加带宽。</td>
</tr>
<tr>
<td><strong>IOPS</strong></td>
<td><code>bs</code>、<code>iodepth</code>、<code>numjobs</code>、<code>rw</code></td>
<td>小块随机 I&#x2F;O 依赖更深队列 (<code>iodepth</code>) 和更多并发 (<code>numjobs</code>) 才能达到高 IOPS。</td>
</tr>
<tr>
<td><strong>延迟 (slat, clat, lat)</strong></td>
<td><code>iodepth</code>、<code>rw</code>, <code>ioengine</code></td>
<td><code>iodepth</code> 增大会带来排队延迟；<code>ioengine</code>（如 libaio vs sync）影响请求提交和完成方式，影响延迟。</td>
</tr>
<tr>
<td><strong>百分位延迟</strong></td>
<td>同上 + <code>iodepth_batch_complete</code>, <code>rate_iops</code>, <code>rate</code></td>
<td>控制批量完成和速率限制参数会影响尾延迟表现，调节请求节奏，避免峰值拥塞。</td>
</tr>
</tbody></table>
<h3 id="HPC-分布式存储系统中影响这四指标的因素"><a href="#HPC-分布式存储系统中影响这四指标的因素" class="headerlink" title="HPC 分布式存储系统中影响这四指标的因素"></a>HPC 分布式存储系统中影响这四指标的因素</h3><p><strong>硬件相关</strong></p>
<ul>
<li>存储介质类型：NVMe SSD、HDD、持久内存（PMEM）等带宽和延迟天差地别。</li>
<li>网络带宽和延迟：分布式存储中，网络往往成为瓶颈，影响总体带宽和延迟。</li>
<li>缓存策略：客户端缓存、服务器端缓存会降低实际 I&#x2F;O 延迟，提高带宽。</li>
</ul>
<p><strong>软件&#x2F;协议相关</strong></p>
<ul>
<li>并行访问算法：<ul>
<li>文件分条（striping）、条带大小（stripe size）</li>
<li>数据复制策略（副本数、纠删码参数）</li>
<li>并发调度策略（请求合并、重排）</li>
</ul>
</li>
<li>I&#x2F;O 协议栈：<ul>
<li>NFS, SMB, Lustre, BeeGFS 等协议处理效率和并发能力差异</li>
<li>TCP&#x2F;IP 堆栈优化，RDMA 等低延迟传输方式</li>
</ul>
</li>
<li>负载均衡：<ul>
<li>多客户端多请求分配到不同存储节点，均衡访问才能保持带宽和低延迟。</li>
</ul>
</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table>
<thead>
<tr>
<th>指标</th>
<th>HPC存储影响因素（示例）</th>
<th>典型调优建议</th>
</tr>
</thead>
<tbody><tr>
<td><strong>bw</strong></td>
<td>硬件带宽、网络带宽、并发数、条带大小</td>
<td>大块顺序读写，提升 <code>bs</code>、<code>iodepth</code>、<code>numjobs</code></td>
</tr>
<tr>
<td><strong>iops</strong></td>
<td>NVMe能力、并行请求数、负载均衡</td>
<td>增加随机小块 <code>iodepth</code> 和 <code>numjobs</code>，用异步 <code>ioengine</code></td>
</tr>
<tr>
<td><strong>延迟</strong></td>
<td>协议栈效率、存储介质响应时间、队列长度</td>
<td>适当控制 <code>iodepth</code>，避免队列过深导致排队延迟</td>
</tr>
<tr>
<td><strong>尾延迟</strong></td>
<td>突发负载、缓存失效、网络抖动</td>
<td>使用 <code>iodepth_batch_complete</code> 等批量参数，限速避免过载</td>
</tr>
</tbody></table>
<h2 id="读写混合测试（randrw）的具体流程"><a href="#读写混合测试（randrw）的具体流程" class="headerlink" title="读写混合测试（randrw）的具体流程"></a>读写混合测试（<code>randrw</code>）的具体流程</h2><p>举例<code>randrw</code> + <code>iodepth=16</code> + <code>numjobs=1</code>：</p>
<ul>
<li><strong>准备阶段</strong><ul>
<li>fio打开目标文件 <code>/tmp/testfile</code>，文件大小100M。</li>
<li>根据<code>bs=4k</code>，文件被切成约 25,600 个块（100M&#x2F;4k）。</li>
</ul>
</li>
<li><strong>执行阶段</strong><ul>
<li>fio的单线程循环：<ul>
<li>它随机选择一个块（因为是<code>randrw</code>，随机读写）。</li>
<li>根据<code>rwmixread=70</code>，它有70%概率选择读，30%概率选择写。</li>
<li>提交一个异步I&#x2F;O请求到操作系统（通过<code>libaio</code>）。</li>
</ul>
</li>
<li>同时，它不会等第一个请求完成就停住，而是会继续提交请求，直到挂起的请求数达到<code>iodepth=16</code>。</li>
<li>当某个I&#x2F;O完成，线程会收到通知，然后提交下一个请求，保持挂起请求数量稳定在16左右。</li>
</ul>
</li>
<li><strong>总结</strong><ul>
<li>这样，fio的单线程模拟了一个深队列、高并发的I&#x2F;O负载。</li>
<li>存储设备能同时处理多个请求，提高吞吐量。</li>
<li>fio收集带宽、IOPS、延迟等指标，反映设备在这种负载下的表现。</li>
</ul>
</li>
</ul>
<h2 id="示例-FIO-代码仓库"><a href="#示例-FIO-代码仓库" class="headerlink" title="示例 FIO 代码仓库"></a>示例 FIO 代码仓库</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://github.com/storpool/fio-tests">The StorPool FIO Test Suite</a>  这个仓库提供基于FIO的块存储性能测试脚本，专为分布式存储系统（如StorPool集群）设计，支持在HPC环境中运行多节点测试。包括预定义的测试模板，适用于随机&#x2F;顺序读写基准，适合分布式块存储的性能评估。仓库中有template目录下的.fio配置文件模板。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/axboe/fio">axboe&#x2F;fio仓库（FIO官方仓库</a>  FIO工具的官方GitHub仓库，examples&#x2F;目录下有大量通用FIO job文件示例。虽然不是专为HPC分布式存储设计，但许多配置（如SSD或NVMe测试）可以修改用于分布式环境（如在HPC集群的多节点并行运行）。例如，ssd-steady.fio适用于高性能存储基准，可结合MPI或脚本实现分布式测试。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/distributed-system-analysis/pbench">distributed-system-analysis&#x2F;pbench仓库</a>  pbench工具集中的FIO基准脚本，专为存储性能测试设计，支持HPC环境下的自动化测试，包括随机&#x2F;顺序工作负载和统计计算。适用于分布式系统，如在集群中测试文件系统I&#x2F;O。文档中描述了如何配置FIO参数以模拟HPC场景。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/ls1intum/storage-benchmarking">ls1intum&#x2F;storage-benchmarking仓库</a>  使用FIO测试容器化环境中的I&#x2F;O性能，适用于分布式存储系统（如Kubernetes集群中的HPC应用）。仓库提供预定义的job配置，适合基准测试分布式存储的性能比较。</p>
</li>
</ol>
</div></article></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2025/08/12/C++%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="C++开发学习笔记" class="prev">PREV</a><a href="/2025/08/11/Linux%E5%86%85%E6%A0%B8%E5%AE%9E%E9%AA%8C%E6%B5%81%E7%A8%8B%E7%AC%94%E8%AE%B0/" title="Linux内核实验流程笔记" class="next">NEXT</a></div><a href="#comment" class="comment-anchor"></a><div id="vcomments"></div><script>new Valine({
    el: "#vcomments",
    appId: "aD8jJBpu4oew3ovNY73z6Rdq-gzGzoHsz",
    appKey: "FdzS5SOPHdhYQoEUngQ8K2QW",
    notify: false,
    verify: false,
    avatar: "robohash",
    visitor: true,
    placeholder: "随便说点什么～.～",
});</script><div class="copyright"><p>© 2016 - 2025 <a target="_blank">David Lee</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p><span id="busuanzi_container_site_pv">本站总访问数：<span id="busuanzi_value_site_pv"></span></span><span id="busuanzi_container_site_uv" style="padding-left: 6px;">访客数：<span id="busuanzi_value_site_uv"></span></span></p><p> <span style="padding-right: 6px;">闽ICP备16007301号-2</span></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/jquery-1.8.2.min.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/articleCatalog.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>